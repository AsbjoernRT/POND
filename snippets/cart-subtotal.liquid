<div id="AjaxCartSubtotal">

  {%- liquid
    if settings.show_currency_codes
      assign iso_code = localization.country.currency.iso_code | prepend: ' ' 
    endif
  -%}

	{%- if type == 'page' -%}
		<div class="cart__subtotal-widget">
			{%- render 'cart-promotion-banner', type: 'page' -%}
		</div>
	{%- endif -%}

	<div class="cart__details 
		{% if type == 'page' %} cart__subtotal-widget {% endif %}
		{% if cart.item_count == 0 %} cart--empty {% endif %}
	">

		<div>
			    
			{%- if cart.cart_level_discount_applications != blank -%} 
				<div class="cart__subtotal cart__details--row">
					<span>{{ 'cart.subtotal' | t }}</span>
					<span>{{ cart.items_subtotal_price | money | append: iso_code }}</span>
				</div>
				<div class="cart__discounts cart__details--row" 
					{% if cart.cart_level_discount_applications.size > 1 %} style="align-items:flex-start;" {% endif %}
				>
					<span>{{ 'cart.discounts' | t }}</span>
					<div class="cart__discount-codes"> 
						{%- for discount_application in cart.cart_level_discount_applications -%}
							<span class="cart__discount-code">
								<span class="cart__discount-code-title">
									{%- render 'theme-symbols', icon: 'discount' -%}
									{{ discount_application.title }}
								</span>
								<span class="cart__discount-code-amount">(-{{ discount_application.total_allocated_amount | money | append: iso_code }})</span>
							</span>
						{%- endfor -%}
					</div>
				</div>
			{%- endif -%}

			<div class="cart__total cart__details--row">
				<span>{{ 'cart.total' | t }}</span> 
				<strong class="text-size--24">{{ cart.total_price | money | append: iso_code }}</strong>
			</div>

			<span class="cart__shipping text-size--14 text-align--right">
				{%- liquid
					if cart.taxes_included and shop.shipping_policy.body != blank
						echo 'cart.policies.taxes_included_and_shipping_policy_html' | t: link: shop.shipping_policy.url
					elsif cart.taxes_included
						echo 'cart.policies.taxes_included_but_shipping_at_checkout' | t
					elsif shop.shipping_policy.body != blank
						echo 'cart.policies.taxes_and_shipping_policy_at_checkout_html' | t: link: shop.shipping_policy.url
					else
						echo 'cart.policies.taxes_and_shipping_at_checkout' | t
					endif
				-%}
			</span>

			{%- if settings.cart_notes_enable and type == 'page' -%}
				<div class="cart__instructions">
					<div class="form-field">
						<cart-note>
							<label for="CartPage-Note">
								{{ 'cart.note' | t }}
							</label>
							<textarea id="CartPage-Note" name="note">{{ cart.note }}</textarea>
						</cart-note> 
					</div>
				</div>
			{%- endif -%}

			{%- if settings.show_discount_code -%}

				{%- liquid
					assign discount_codes = cart.cart_level_discount_applications | where: 'type', 'discount_code' | map: 'title'
					for item in cart.items
						for allocation in item.line_level_discount_allocations
							if allocation.discount_application.type == 'discount_code'
								assign discount_codes = item.line_level_discount_allocations | slice: forloop.index0 | map: 'discount_application' | map: 'title' | concat: discount_codes
							endif
						endfor
					endfor
					assign discount_codes = discount_codes | uniq
				-%}

				{%- if type == 'page' -%}
					<div class="cart__coupons">
						<div class="form-field">
							<cart-discounts>

								<label for="CartPage-Discount">
									{{ 'cart.discount_codes_label' | t }}
								</label>
							
								<form class="cart__coupons-form">
									<input id="CartPage-Discount" name="discount" type="text" data-js-discount-input>
									<button type="submit" id="cartDiscountSubmit" class="button button--small button--small-mobile button--solid-accent-scheme" data-js-discount-submit>
										{{ 'collections.apply' | t }}
									</button>
								</form>

								{%- if settings.discount_text != blank -%}
									<div class="cart__coupons-label text-size--14 text-color--opacity">
										{{ settings.discount_text | escape }}
									</div>
								{%- endif -%}
								
								<div class="cart__coupons-error" data-js-discount-error></div>

								{% style %}
									cart-discounts .alert {
										background-image: url('data:image/svg+xml;utf8,<svg fill="none" height="29" viewBox="0 0 29 29" width="29" xmlns="http://www.w3.org/2000/svg"><circle cx="14.5" cy="14.5" fill="{{ settings.color_scheme_drawers.settings.text | url_encode }}" r="14.5"/><path d="m16.1429 13.4293-.8134 4.2169h-1.4961l-.8334-4.2169v-5.4293h3.1429zm-.0804 5.4792v3.0915h-2.9922v-3.0915z" fill="{{ settings.color_scheme_drawers.settings.background | url_encode }}"/></svg>');
									}
								{% endstyle %}
								
								<div class="cart__coupons-codes">
									{%- for discount_code in discount_codes -%}
										{%- render 'cart-item-discount', discount: discount_code, remove: true -%}
									{%- endfor -%}
								</div>

							</cart-discounts>
						</div>
					</div>
				{%- else -%}
					<div data-js-discount-codes style="display: none !important">
						{%- for discount_code in discount_codes -%}
							{%- render 'cart-item-discount', discount: discount_code, remove: true -%}
						{%- endfor -%}
					</div>
				{%- endif -%}
			{%- endif -%}

		</div>

		{%- if settings.cart_terms_checkbox -%}
			<terms-checkbox>
				<div class="agree-to-terms gutter-top--small gutter-bottom--small">
					<input type="checkbox" id="AgreeToTos" class="styled-checkbox" required />
					<label for="AgreeToTos" class="text-size--14">
						{{ settings.cart_terms_text }}
					</label>
				</div>
			</terms-checkbox>

			<script src="{{ 'component-terms-checkbox.js' | asset_url }}" defer></script>
		{%- endif -%}

		<div {% unless template.name == 'cart' %} class="cart__buttons flex-buttons" {% endunless %}>

			{%- unless type == 'page' -%}
				<a id="ViewCart" href="{{ routes.cart_url }}" class="button button--regular button--fullwidth button--outline--hover-accent">
					<span class="button__text">{{ 'cart.view_cart' | t }}</span>
				</a>
			{%- endunless -%}
			
			<button id="CheckOut" class="button button--regular button--solid--hover-accent button--fullwidth" type="submit" name="checkout" form="cart" {%- if settings.cart_terms_checkbox -%} disabled {%- endif -%}>
				<span class="button__text">{{ 'cart.checkout' | t }}</span>
			</button>

			{%- unless template.name == 'order' -%}  
				{%- if additional_checkout_buttons and settings.cart_additional_buttons -%}
					<div class="additional-checkout-buttons additional-checkout-buttons--vertical" style="width:100%">
						{{ content_for_additional_checkout_buttons }}
					</div>
				{%- endif -%}
			{%- endunless -%}
			
		</div>

	</div>

</div>