{%- liquid
  assign column_mobile = block.settings.column_mobile | default: 1 | plus: 0
  assign column_desktop = block.settings.column_desktop | default: 2 | plus: 0
  assign row_mobile = block.settings.row_mobile | default: 1 | plus: 0
  assign row_desktop = block.settings.row_desktop | default: 1 | plus: 0

  assign block_index = section.blocks | find_index: 'id', block.id
  if section.index == 1 and block_index < 2
    assign preload = true
  else
    assign preload = false
  endif
-%}

<div
  id="element-{{ block.id }}"
  class="
    block-grid-item card card--hover card-hover-animation--accent-without-text js-slider-item card--minimum-aspect-ratio
    {% if block.settings.remove_padding %}card--no-padding{% endif %}
    {% if block.settings.remove_border_radius or block.settings.remove_padding %}card--no-radius{% endif %}
  "
  style="
    --column-desktop: {{ column_desktop }};
    --column-mobile: {{ column_mobile }};
    --row-mobile: {{ row_mobile }};
    --row-desktop: {{ row_desktop }};
  "
  data-js-prlx-parent
  {{ block.shopify_attributes }}
>
  {%- if block.settings.link != blank -%}
    <a
      href="{{ block.settings.link }}"
      class="card__whole-link card__whole-link--alternate"
      aria-hidden="true"
      {%- if block.settings.open_in_new_window -%}
        target="_blank"
      {%- endif -%}
    ></a>
    {%- assign hover_animation = true -%}
  {%- else -%}
    {%- assign hover_animation = false -%}
  {%- endif -%}

  {%- render 'media-shape', shape: block.settings.media_shape, id: block.id, element: 'element' -%}

  {%- if block.settings.card_hover == 'accent' -%}
    <div class="card__hover"></div>
  {%- endif -%}

  <div class="card__content" data-js-prlx-children>
    <div class="card__image-holder">
      <div class="card__image">
        {%- unless block.settings.video_object == blank -%}
          {%- render 'video-component',
            video_file: block.settings.video_object,
            image: block.settings.image,
            id: block.id,
            autoplay_video: true,
            loop_video: true,
            is_background: true,
            crop_video: true,
            overlay: block.settings.image_overlay,
            overlay_opacity: block.settings.image_overlay_opacity
          -%}
          <script>
            window.KrownAssetLoader.loadScript('{{ "component-video.js" | asset_url }}');
          </script>

        {%- elsif block.settings.image != blank -%}
          {%- render 'lazy-image',
            image: block.settings.image,
            image_alignment: true,
            preload: preload,
            type: 'background',
            alt: block.settings.image.alt,
            image_sizes_custom: true,
            id: block.id,
            overlay: block.settings.image_overlay,
            overlay_opacity: block.settings.image_overlay_opacity,
            prlx: true,
            hover_animation: hover_animation
          -%}

        {%- else -%}
          {{ 'product-apparel-1' | placeholder_svg_tag }}
        {%- endunless -%}
      </div>
    </div>

    {%- if block.blocks.size > 0 -%}
      <div class="align-content align-content--{{ block.settings.alignment }}">
        <div
          class="
            card__text
            gutter--{{ block.settings.gutter }}
          "
          style="
            --horizontal-alignment:{{ block.settings.alignment | split: ' ' | first | replace: 'horizontal-', '' }};
            color: var(--color-scheme-text);
          "
        >
          <div
            class="
              spacing--custom remove-empty-space
              element--width-{{ block.settings.width }}
            "
            style="--spacing:{{ block.settings.spacing }}px;"
          >
            {% content_for 'blocks' %}
          </div>
        </div>
      </div>
    {% endif %}
  </div>

  {%- if block.settings.add_gallery_item_border and block.settings.media_shape == 'none' -%}
    {%- assign border_width_grid_max = settings.border_width_grid | at_most: settings.border_width_sections -%}
    {% style %}
      #element-{{ block.id }} .card__image {
        border: {{ border_width_grid_max }}px {{ settings.border_style_grid }} var(--color-scheme-text);
      }
    {% endstyle %}
  {%- endif -%}

  {%- liquid
    assign card_class = '#element-' | append: block.id | append: ' .card__content'
    render 'color-scheme', color_scheme: block.settings.color_scheme_card, class: card_class, force_color_scheme: true
  -%}
</div>

{% schema %}
{
  "name": "t:theme_blocks.grid-media.name",
  "tag": null,
  "blocks": [{ "type": "@app" }, { "type": "@theme" }],
  "settings": [
    {
      "id": "image",
      "type": "image_picker",
      "label": "t:sections.gallery.blocks.image.settings.image.label"
    },
    {
      "type": "video",
      "id": "video_object",
      "label": "t:sections.local-extra-words.sections.media-with-text-overlay.blocks.video.name",
      "info": "t:sections.video-background.settings.image.info"
    },
    {
      "type": "color",
      "id": "image_overlay",
      "label": "t:raw-extra-words.settings_schema.labels.media_overlay",
      "default": "rgba(0,0,0,0)"
    },
    {
      "type": "range",
      "id": "image_overlay_opacity",
      "label": "t:raw-extra-words.settings_schema.labels.media_overlay_opacity",
      "min": 0,
      "max": 60,
      "step": 1,
      "default": 30,
      "unit": "%"
    },
    {
      "type": "select",
      "id": "media_shape",
      "label": "t:raw-extra-words.settings_schema.labels.media_shape",
      "options": [
        {
          "value": "none",
          "label": "t:raw-extra-words.settings_schema.labels.media_shape_options.option_0"
        },
        {
          "value": "9999px 9999px var(--brg) var(--brg)",
          "label": "t:raw-extra-words.settings_schema.labels.media_shape_options.option_1"
        },
        {
          "value": "var(--brg) 9999px 9999px var(--brg)",
          "label": "t:raw-extra-words.settings_schema.labels.media_shape_options.option_2"
        },
        {
          "value": "var(--brg) var(--brg) 9999px 9999px",
          "label": "t:raw-extra-words.settings_schema.labels.media_shape_options.option_3"
        },
        {
          "value": "9999px var(--brg) var(--brg) 9999px",
          "label": "t:raw-extra-words.settings_schema.labels.media_shape_options.option_4"
        },
        {
          "value": "9999px 9999px 9999px 9999px",
          "label": "t:raw-extra-words.settings_schema.labels.media_shape_options.option_5"
        }
      ],
      "default": "none"
    },
    {
      "type": "checkbox",
      "id": "add_gallery_item_border",
      "visible_if": "{{ block.settings.media_shape == 'none' }}",
      "label": "t:raw-extra-words.sections.main-product.settings.gallery.add_borders",
      "info": "t:raw-extra-words.sections.main-product.settings.gallery.borders_info",
      "default": false
    },
    {
      "type": "url",
      "id": "link",
      "label": "t:sections.image-with-text.blocks.image.settings.url.label",
      "info": "t:theme_blocks.slide_image.settings.info"
    },
    {
      "type": "checkbox",
      "id": "open_in_new_window",
      "visible_if": "{{ block.settings.link != blank }}",
      "label": "t:sections.local-extra-words.sections.announcement-bar.blocks.content.settings.target",
      "default": false
    },
    {
      "type": "header",
      "content": "t:theme_blocks.sections.flex-section.grid_design"
    },
    {
      "type": "range",
      "id": "column_desktop",
      "min": 2,
      "max": 12,
      "step": 1,
      "label": "t:theme_blocks.grid-text.column_desktop",
      "default": 2
    },
    {
      "type": "range",
      "id": "row_desktop",
      "min": 1,
      "max": 4,
      "step": 1,
      "label": "t:theme_blocks.grid-text.row_desktop",
      "default": 1
    },
    {
      "type": "checkbox",
      "id": "hide_on_mobile",
      "label": "t:raw-extra-words.sections.collections.promo.settings.hide_on_mobile",
      "default": false
    },
    {
      "type": "select",
      "id": "column_mobile",
      "visible_if": "{{ block.settings.hide_on_mobile == false }}",
      "label": "t:theme_blocks.grid-text.column_mobile",
      "options": [
        {
          "label": "t:sections.local-extra-words.sections.columns.option__0",
          "value": "1"
        },
        {
          "label": "t:sections.local-extra-words.sections.columns.option__1",
          "value": "2"
        }
      ],
      "default": "1"
    },

    {
      "type": "select",
      "id": "row_mobile",
      "visible_if": "{{ block.settings.hide_on_mobile == false }}",
      "label": "t:theme_blocks.grid-text.row_mobile.label",
      "options": [
        {
          "label": "t:theme_blocks.grid-text.row_mobile.option_1",
          "value": "1"
        },
        {
          "label": "t:theme_blocks.grid-text.row_mobile.option_2",
          "value": "2"
        }
      ],
      "default": "1"
    },
    {
      "type": "header",
      "content": "t:settings_schema.typography.name"
    },
    {
      "type": "select",
      "id": "alignment",
      "label": "t:sections.image-with-text.settings.text_alignment.label",
      "options": [
        {
          "value": "horizontal-left align-content--vertical-top",
          "label": "t:sections.image-with-text.settings.text_alignment.options__1.label"
        },
        {
          "value": "horizontal-center align-content--vertical-top",
          "label": "t:sections.image-with-text.settings.text_alignment.options__2.label"
        },
        {
          "value": "horizontal-right align-content--vertical-top",
          "label": "t:sections.image-with-text.settings.text_alignment.options__3.label"
        },
        {
          "value": "horizontal-left align-content--vertical-middle",
          "label": "t:sections.image-with-text.settings.text_alignment.options__4.label"
        },
        {
          "value": "horizontal-center align-content--vertical-middle",
          "label": "t:sections.image-with-text.settings.text_alignment.options__5.label"
        },
        {
          "value": "horizontal-right align-content--vertical-middle",
          "label": "t:sections.image-with-text.settings.text_alignment.options__6.label"
        },
        {
          "value": "horizontal-left align-content--vertical-bottom",
          "label": "t:sections.image-with-text.settings.text_alignment.options__7.label"
        },
        {
          "value": "horizontal-center align-content--vertical-bottom",
          "label": "t:sections.image-with-text.settings.text_alignment.options__8.label"
        },
        {
          "value": "horizontal-right align-content--vertical-bottom",
          "label": "t:sections.image-with-text.settings.text_alignment.options__9.label"
        }
      ],
      "default": "horizontal-left align-content--vertical-bottom"
    },
    {
      "type": "range",
      "id": "spacing",
      "label": "t:raw-extra-words.settings_schema.labels.spacing",
      "min": -12,
      "max": 60,
      "step": 1,
      "default": 12,
      "unit": "px"
    },
    {
      "type": "select",
      "id": "gutter",
      "label": "t:raw-extra-words.sections.vertical-slider.settings.text.text_padding",
      "options": [
        {
          "value": "none",
          "label": "t:raw-extra-words.settings_schema.labels.media_shape_options.option_0"
        },
        {
          "value": "grid-padding",
          "label": "t:raw-extra-words.settings_schema.options.default"
        },
        {
          "value": "large",
          "label": "t:raw-extra-words.settings_schema.options.regular"
        },
        {
          "value": "xlarge",
          "label": "t:raw-extra-words.settings_schema.options.large"
        }
      ],
      "default": "large"
    },
    {
      "type": "select",
      "id": "width",
      "label": "t:sections.image-with-text.settings.text_width.label",
      "options": [
        {
          "label": "t:raw-extra-words.settings_schema.options.small",
          "value": "50"
        },
        {
          "label": "t:sections.image-with-text.settings.text_width.options__1.label",
          "value": "70"
        },
        {
          "label": "t:sections.image-with-text.settings.text_width.options__2.label",
          "value": "90"
        }
      ],
      "default": "70"
    },
    {
      "type": "header",
      "content": "t:raw-extra-words.settings_schema.colors.header_inner"
    },
    {
      "type": "color_scheme",
      "id": "color_scheme_card",
      "label": "t:color-schemes.name_singular",
      "default": "scheme_1"
    },
    {
      "type": "checkbox",
      "id": "remove_border_radius",
      "label": "t:raw-extra-words.settings_schema.borders.remove.radius",
      "default": false
    },
    {
      "type": "checkbox",
      "id": "remove_padding",
      "label": "t:raw-extra-words.settings_schema.borders.remove.padding_and_border",
      "default": false
    }
  ],
  "presets": [
    {
      "name": "t:theme_blocks.grid-media.name",
      "blocks": [
        {
          "type": "text",
          "settings": {
            "text": "<p>Use this text to share information about your brand with your customers. Describe a product, share announcements or welcome customers to your store.</p>"
          }
        }
      ]
    }
  ]
}
{% endschema %}
